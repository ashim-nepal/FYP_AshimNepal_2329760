<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Account</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-xl mx-auto bg-white shadow-lg rounded-lg p-6">
    <h2 class="text-2xl font-bold text-center text-green-700 mb-6">My Account</h2>
    
    <form id="change-password-form" class="space-y-4">
      <div>
        <label class="block text-gray-700 font-medium">Email</label>
        <input type="email" value="{{ user_email }}" disabled class="w-full p-3 border rounded bg-gray-100" />
      </div>

      <div>
        <label class="block text-gray-700 font-medium">Current Password</label>
        <input type="password" id="current-password" class="w-full p-3 border rounded" required />
      </div>

      <div>
        <label class="block text-gray-700 font-medium">New Password</label>
        <input type="password" id="new-password" class="w-full p-3 border rounded" required />
      </div>

      <div>
        <label class="block text-gray-700 font-medium">Confirm New Password</label>
        <input type="password" id="confirm-password" class="w-full p-3 border rounded" required />
      </div>

      <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded">Update Password</button>
    </form>

    <p class="text-sm mt-6 text-center text-green-600 underline cursor-pointer" onclick="window.location.href='/forgot-password/'">Forgot Password?</p>
  </div>

  <script>
    document.getElementById("change-password-form").addEventListener("submit", async function (e) {
      e.preventDefault();
      const oldPassword = document.getElementById("current-password").value;
      const newPassword = document.getElementById("new-password").value;
      const confirmPassword = document.getElementById("confirm-password").value;
      const user_email = "{{user_email}}";

      if (newPassword === oldPassword) {
        alert("New Password cannot be same as old password.");
        return;
      }

      if (newPassword !== confirmPassword) {
        alert("New passwords do not match.");
        return;
      }

      const response = await fetch("/api/update-password/", {
        method: "POST",
        headers: { "Content-Type": "application/json", "X-CSRFToken": getCSRFToken() },
        body: JSON.stringify({user_email:user_email, old_password: oldPassword, new_password: newPassword, confirm_password:confirmPassword })
      });

      const result = await response.json();
      alert(result.message || result.error);
      history.back();

    });

    function getCSRFToken() {
      return document.cookie.split("; ").find(row => row.startsWith("csrftoken="))?.split("=")[1];
    }
  </script>
</body>
</html>

