<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor's Profile | {{doctor.name}}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Optional: Styling for the scrollbar in the working time section */
    ::-webkit-scrollbar {
      height: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #29622E;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-track {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body class="bg-gray-50">

  <section>
    Nav here
    <button onclick="confirmLogout()" class="text-green-700 font-semibold hover:underline">Logout</button>
  </section>

  <section class="p-6">
    <header class="text-2xl text-[#29622E] font-bold text-center mb-8">
      {{ branch_name }} | Dr. {{ doctor.name }}
    </header>

    <div class="flex flex-wrap lg:flex-nowrap gap-6">

      <div class="flex flex-col items-center bg-white shadow-md p-6 rounded-lg w-full lg:w-1/3">

        <div class="w-36 h-36 bg-gray-200 rounded-full mb-4"></div>
        <p class="text-sm text-[#29622E] mb-4">NMC Registration No: {{ doctor.nmc_registration}}</p>



        <div class="mt-6">
          <p class="text-center mb-4 font-bold text-lg text-gray-700">My Rating‚≠ê: {{doctor.rating}} / 10</p>
        </div>


        <div id="rating-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white hidden rounded-lg shadow-lg p-6 w-11/12 max-w-md">
            <h2 class="text-lg font-bold text-[#29622E] mb-4"></h2>
            <div class="flex items-center justify-between">
            </div>
            <div class="flex justify-end mt-6 space-x-4">
            </div>
          </div>
        </div>
      </div>


      <div class="bg-white shadow-md p-6 rounded-lg w-full lg:w-2/3">
        <p class="mb-4"><span class="font-bold">Name:</span> Dr. {{doctor.name}}</p>
        <p class="mb-4"><span class="font-bold">Email:</span> {{doctor.email}}</p>
        <p class="mb-4"><span class="font-bold">Department:</span> {{doctor.department}}</p>
        <p class="mb-4"><span class="font-bold">Expertise:</span> {{doctor.expertise}}</p>
        <p class="mb-4"><span class="font-bold">Education:</span> {{doctor.education}}</p>
        <p class="mb-4"><span class="font-bold">Hospitals Worked:</span> {{doctor.hospitals_worked}}</p>
        <p class="mb-4"><span class="font-bold">Achievements:</span> {{doctor.achievements}}</p>
        <button onclick="document.getElementById('appointment-modal').classList.remove('hidden')" 
            class="bg-[#29622E] text-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-[#29450E] text-700">
            View Appointment Requests
        </button>
        <button id="viewAppointments" 
            class="bg-[#29622E] text-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-[#29450E] text-700">
            View Upcoming Appointments
        </button>
        <button id="pastAppointments" 
            class="bg-[#29622E] text-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-[#29450E] text-700">
            View Past Appointments
        </button>

  </section>


  <section id ="scheduling-section">

  <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">Set Your Availability</h2>
    
    <div id="schedule-container" class="space-y-4">


    </div>

    <button id="save-schedule"
        class="mt-6 w-150 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
        Save Availability
    </button>
</div>
</section>


  <section>
    Footer here
  </section>


  <!-- Appointment Modal -->
<div id="appointment-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center">
  <div class="bg-white w-500 p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-bold mb-4">Appointment Requests</h3>
      <table class="w-full bg-gray-100 border">
          <thead>
              <tr class="text-gray-700">
                  <th class="border px-4 py-2">Patient</th>
                  <th class="border px-4 py-2">Date</th>
                  <th class="border px-4 py-2">Time</th>
                  <th class="border px-4 py-2">Status</th>
                  <th class="border px-4 py-2">Actions</th>
              </tr>
          </thead>
          <tbody id="appointment-list"></tbody>
      </table>
      <button onclick="document.getElementById('appointment-modal').classList.add('hidden')" class="bg-gray-500 text-white px-3 py-1 rounded mt-4">Close</button>
  </div>
</div>

<!-- Rejection Modal -->
<div id="rejection-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center">
  <div class="bg-white w-96 p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-bold mb-4">Reject Appointment</h3>
      <textarea id="rejection-reason" class="w-full border p-2 rounded" placeholder="Enter reason for rejection"></textarea>
      <button id="reject-appointment" class="bg-red-600 text-white px-4 py-2 rounded mt-4">Reject</button>
      <button onclick="document.getElementById('rejection-modal').classList.add('hidden')" class="bg-gray-500 text-white px-3 py-1 rounded mt-4">Close</button>
  </div>
</div>


<!-- View Upcoming Appointments Modal -->
<div id="appointmentDialogue" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center">
  <div class="bg-white w-180 p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-bold mb-4">My Upcoming Appointments</h3>
      <table class="w-full bg-gray-100 border">
        <thead>
            <tr class="text-gray-700">
                <th class="border px-4 py-2">Patient</th>
                <th class="border px-4 py-2">Date</th>
                <th class="border px-4 py-2">Time</th>
                <th class="border px-4 py-2">Prescription</th>
                <th class="border px-4 py-2">Actions</th>
            </tr>
        </thead>
        <tbody id="appointmentList"></tbody>
    </table>
    <button onclick="document.getElementById('appointmentDialogue').classList.add('hidden')" class="bg-gray-500 text-white px-3 py-1 rounded mt-4">Close</button>
  </div>
</div>

<!-- View Past Appointments Modal -->
<div id="pastappointmentDialogue" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center">
  <div class="bg-white w-180 p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-bold mb-4">Past Appointments</h3>

      <!-- Auto-Sorting Search Bar -->
    <div class="mb-4 flex">
      <label>Sort By:</label>
      <label>Patient's Email: </label> <input type="email" id="searchEmail" placeholder="Search by Patient Email" class="w-1/3 p-2 border rounded-md mr-2">
      <label>Date: </label> <input type="date" id="searchDate" class="w-1/4 p-2 border rounded-md mr-2">
      <button id="clearFilters" class="bg-[#256898] bg-500 text-white px-4 py-2 rounded">Clear</button>
  </div>

      <table class="w-full bg-gray-100 border">
        <thead>
            <tr class="text-gray-700">
                <th class="border px-4 py-2">Patient</th>
                <th class="border px-4 py-2">Date</th>
                <th class="border px-4 py-2">Time</th>
                <th class="border px-4 py-2">Prescription</th>
                <th class="border px-4 py-2">Status</th>
            </tr>
        </thead>
        <tbody id="pastappointmentList"></tbody>
    </table>
    <button onclick="document.getElementById('pastappointmentDialogue').classList.add('hidden')" class="bg-gray-500 text-white px-3 py-1 rounded mt-4">Close</button>
  </div>
</div>

<!-- Prescription Modal -->
<div id="prescriptionModal" class="fixed inset-0 flex items-center justify-center hidden bg-gray-900 bg-opacity-50">
  <div class="bg-white w-1000 p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4 text-center">Prescription</h2>

      <form id="prescriptionForm">
        <div id="prescription-info">
        </div>
          <input type="hidden" id="prescriptionId">
          <input type="hidden" id="appointmentId">
          
          <label class="block font-semibold">Blood Pressure(Systolic):</label>
          <input type="float" id="bloodPressure-sys" class="w-full p-2 border rounded-md mb-2 required"><span>mm/Hg</span>

          <label class="block font-semibold">Blood Pressure(Diastolic):</label>
          <input type="float" id="bloodPressure-dias" class="w-full p-2 border rounded-md mb-2 required"><span>mm/Hg</span>

          <label class="block font-semibold">Diabetes:</label>
          <input type="float" id="diabetes" class="w-full p-2 border rounded-md mb-2 required">

          <label class="block font-semibold">Medication:</label>
          <textarea id="medication" class="w-full p-2 border rounded-md mb-2 required"></textarea>

          <label class="block font-semibold">Notes:</label>
          <textarea id="notes" class="w-full p-2 border rounded-md mb-2 required"></textarea>

          <div class="flex justify-end mt-4">
              <button type="button" id="closeModal" class="px-4 py-2 bg-gray-500 text-white rounded-md mr-2">Cancel</button>
              <button type="submit" class="px-4 py-2 bg-[#29622E] text-white rounded-md">Save Prescription</button>
          </div>
      </form>
  </div>
</div>





  <script>
    document.addEventListener("DOMContentLoaded", async function () {
    let scheduleContainer = document.getElementById("schedule-container");
    let saveButton = document.getElementById("save-schedule");
  
  
      async function fetchSchedule() {
        try{
          let response = await fetch("/api/get-doctor-schedule/{{ doctor.email}}/");
          console.log(response);


      let result = await response.json(); // Convert JSON only if valid response
      console.log(result);
  
          scheduleContainer.innerHTML = "";
  
          let days = result.schedule || [];
  
          for (let i = 0; i < 7; i++) {
              let day = days[i] || {
                  date: getFutureDate(i+2),
                  working_day_type: null,
                  is_locked: false
              };
  
              let isLocked = day.is_locked ? "disabled" : "";
              let selectedOption = day.working_day_type || "None"; // Handle new entries
              let emergencyChecked = day.emergency_available ? "checked" : "";
  
              let row = `
                  <div class="flex justify-between items-center mb-4 p-3 border border-gray-300 rounded">
                      <span class="font-semibold">${day.date}-${day.day}</span>
                      <select data-date="${day.date}" class="schedule-select w-48 p-2 border rounded" ${isLocked}>
                          <option value="None" ${selectedOption === "None" ? "selected" : ""}>Not Set</option>
                          <option value="Full" ${selectedOption === "Full" ? "selected" : ""}>Full Day</option>
                          <option value="Half_Morning" ${selectedOption === "Half_Morning" ? "selected" : ""}>Half Day - Morning</option>
                          <option value="Half_Evening" ${selectedOption === "Half_Evening" ? "selected" : ""}>Half Day - Evening</option>
                          <option value="Leave" ${selectedOption === "Leave" ? "selected" : ""}>Leave</option>
                      </select>
                      <label class="flex items-center space-x-2">
                        <input type="checkbox" data-date="${day.date}" class="emergency-checkbox" ${emergencyChecked} ${isLocked}>
                        <span>Emergency Available</span>
                    </label>
                  </div>`;
              scheduleContainer.innerHTML += row;
          }
      } catch(error){
        console.log(error);
      }
    
    }
  
      saveButton.addEventListener("click", async function () {
          let selects = document.querySelectorAll(".schedule-select");
          let checkboxes = document.querySelectorAll(".emergency-checkbox");
          let scheduleData = [];
  
          selects.forEach((select, index) => {
              let selectedValue = select.value !== "None" ? select.value : null;
              scheduleData.push({
                  date: select.getAttribute("data-date"),
                  working_day_type: selectedValue,
                  emergency_available: checkboxes[index].checked,
              });
          });
  
          let response = await fetch("/api/update-doctor-schedule/{{ doctor.email }}/", {
              method: "POST",
              headers: { "Content-Type": "application/json", "X-CSRFToken": getCSRFToken() },
              body: JSON.stringify({ schedule: scheduleData })
          });

  
          let result = await response.json();
          document.getElementById("response-message").innerText = result.message || "Error updating schedule";
  
          fetchSchedule(); // Reload after saving
      });
  
      function getFutureDate(daysAhead) {
          let today = new Date();
          today.setDate(today.getDate() + daysAhead);
          return today.toISOString().split("T")[0];
      }
  
      function getCSRFToken() {
          return document.cookie.split("; ").find(row => row.startsWith("csrftoken="))?.split("=")[1];
      }
  
      fetchSchedule();
    });


    // Appointments booking viewing appointments, accepting and rejecting
    document.addEventListener("DOMContentLoaded", function () {
      const appointmentList = document.getElementById("appointment-list");
      const responseMessage = document.getElementById("response-message");
      const rejectionModal = document.getElementById("rejection-modal");
      const rejectionReasonInput = document.getElementById("rejection-reason");
      let selectedAppointmentId = null;
  
      async function fetchAppointments() {
          let response = await fetch("/api/get-doctor-appointments/");
          let result = await response.json();
          
          const filteredAppointments = result.appointments.filter(
            (appointments) => appointments.appointment_status === "Pending"
          );
          console.log(filteredAppointments);
  
          appointmentList.innerHTML = ""; // Clear existing data
  
          if (filteredAppointments.length === 0) {
              appointmentList.innerHTML = "<p class='text-gray-500 text-center'>No pending appointment requests.</p>";
              return;
          }
  
          filteredAppointments.forEach((appointment) => {
              let row = `
                  <tr class="border-b">
                      <td class="px-4 py-2"><a href="/viewPatientProfile/${appointment.patient_email}/"> ${appointment.patient_email}</a></td>
                      <td class="px-4 py-2">${appointment.appointment_date}</td>
                      <td class="px-4 py-2">${appointment.appointment_time}</td>
                      <td class="px-4 py-2">${appointment.is_emergency ? "üö® Emergency" : "Regular"}</td>
                      <td class="px-4 py-2">
                          <button onclick="approveAppointment('${appointment.id}')" class="bg-green-600 text-white px-3 py-1 rounded">Accept</button>
                          <button onclick="openRejectionModal('${appointment.id}')" class="bg-red-600 text-white px-3 py-1 rounded ml-2">Reject</button>
                      </td>
                  </tr>`;
              appointmentList.innerHTML += row;
          });
      }
  
      window.approveAppointment = async function (appointmentId) {
          let response = await fetch("/api/manage-appointment-request/", {
              method: "POST",
              headers: { "Content-Type": "application/json", "X-CSRFToken": getCSRFToken() },
              body: JSON.stringify({ appointment_id: appointmentId, action: "Accept" }),
          });
  
          let result = await response.json();
          alert(result.message || "Could not Process Task");
          fetchAppointments();
      };
  
      window.openRejectionModal = function (appointmentId) {
          selectedAppointmentId = appointmentId;
          rejectionModal.classList.remove("hidden");
      };
  
      document.getElementById("reject-appointment").addEventListener("click", async function () {
          let rejectionReason = rejectionReasonInput.value.trim();
          if (!rejectionReason) {
              alert("Please provide a reason for rejection.");
              return;
          }
  
          let response = await fetch("/api/manage-appointment-request/", {
              method: "POST",
              headers: { "Content-Type": "application/json", "X-CSRFToken": getCSRFToken() },
              body: JSON.stringify({ appointment_id: selectedAppointmentId, action: "Reject", rejection_reason: rejectionReason }),
          });
  
          let result = await response.json();
          rejectionModal.classList.add("hidden");
          print(result);
          alert(result.message || "Could not Process Task");
          fetchAppointments();
      });
  
      function getCSRFToken() {
          return document.cookie.split("; ").find((row) => row.startsWith("csrftoken="))?.split("=")[1];
      }
  
      fetchAppointments();
  });



  // Upcoming Appointments
  document.getElementById("viewAppointments").addEventListener("click", function() {
    fetch('/api/get-doctor-appointments/')
        .then(response => response.json())
        .then(data => {
          const filteredAppointments = data.appointments.filter(
            (appointments) => appointments.appointment_status === "Approved" // && appointments.appointment_status != "Rejected"
          );

          document.getElementById("appointmentDialogue").classList.remove("hidden")

          console.log(filteredAppointments);
          if (filteredAppointments.length === 0) {
            appointmentList.innerHTML = "<p class='text-gray-500 text-center'>No any upcoming appointments.</p>";
            return;
        }
            let content = "";
            filteredAppointments.forEach(appointment => {
                let disabled = (appointment.appointment_status === "Completed" || appointment.appointment_status === "Cancelled") ? "disabled" : "";
                let completedColor = (disabled) ? "gray" : "green";
                let cancelledColor = (disabled) ? "gray" : "red";
                
                content += `
                      <tr class="border-b">
                      <td class="px-4 py-2"><a href="/viewPatientProfile/${appointment.patient_email}/">${appointment.patient_email}</a></td>
                      <td class="px-4 py-2">${appointment.appointment_date}</td>
                      <td class="px-4 py-2">${appointment.appointment_time}</td>
                      <td class="px-4 py-2">
                        <button onclick="openPrescription('${appointment.id}', '${appointment.appointment_date}')" 
                          style="background: none; border: none;">
                          üìÑüìÑüìÑüìÑ
                        </button>
                      </td>
                      <td class="px-4 py-2">
                          <button onclick="updateStatus('${appointment.id}', 'Completed')" class="bg-${completedColor}-600 text-white px-3 py-1 rounded" ${disabled}>Complete</button>
                          <button onclick="updateStatus('${appointment.id}', 'Cancelled')" class="bg-${cancelledColor}-600 text-white px-3 py-1 rounded ml-2" ${disabled}>Cancel</button>
                      </td>
                  </tr>
                `;
            });
            document.getElementById("appointmentList").innerHTML = content;
        });
});

function updateStatus(appointment_id, status) {
    fetch('/api/update-appointment/', { 
        method: "POST", 
        body: JSON.stringify({ appointment_id, status }),
        headers: { "Content-Type": "application/json" }
    })
    .then(() => alert(`Appointment marked as ${status}!`))
    .then(() => location.reload());
}


// Past
document.getElementById("pastAppointments").addEventListener("click", function () {
  fetch('/api/get-doctor-appointments/')
      .then(response => response.json())
      .then(data => {
          let allAppointments = data.appointments.filter(
              appointment => appointment.appointment_status === "Completed" || appointment.appointment_status === "Cancelled"
          );

          document.getElementById("pastappointmentDialogue").classList.remove("hidden");

          if (allAppointments.length === 0) {
              document.getElementById("pastappointmentList").innerHTML = "<p class='text-gray-500 text-center'>No past appointments exist.</p>";
              return;
          }

          // Store data globally for filtering
          window.filteredAppointments = allAppointments;
          displayAppointments(allAppointments);
      });
});

// Filtering Function - Runs Automatically as User Inputs Data
document.getElementById("searchEmail").addEventListener("input", filterAppointments);
document.getElementById("searchDate").addEventListener("change", filterAppointments);
document.getElementById("clearFilters").addEventListener("click", clearFilters);

function filterAppointments() {
  let email = document.getElementById("searchEmail").value.trim().toLowerCase();
  let date = document.getElementById("searchDate").value;

  let filtered = window.filteredAppointments;

  if (email) {
      filtered = filtered.filter(appointment => 
          appointment.patient_email.toLowerCase().includes(email)
      );
  }
  if (date) {
      filtered = filtered.filter(appointment => appointment.appointment_date === date);
  }

  displayAppointments(filtered);
}

// Function to Display Appointments in the Table
function displayAppointments(appointments) {
  let content = "";

  if (appointments.length === 0) {
      content = "<p class='text-gray-500 text-center'>No matching appointments found.</p>";
  } else {
      appointments.forEach(appointment => {
          let text_color = (appointment.appointment_status === "Completed") ? "Completed" : "";
          let completedColor = (text_color) ? "green" : "red";

          content += `
              <tr class="border-b">
                  <td class="px-4 py-2"><a href="/viewPatientProfile/${appointment.patient_email}/">${appointment.patient_email}</a></td>
                  <td class="px-4 py-2">${appointment.appointment_date}</td>
                  <td class="px-4 py-2">${appointment.appointment_time}</td>
                  <td class="px-4 py-2">
                      <button onclick="openPrescription('${appointment.id}', '${appointment.appointment_date}')" 
                          style="background: none; border: none;">
                          üìÑüìÑüìÑüìÑ
                      </button>
                  </td>
                  <td class="px-4 py-2"><span class="bg-white text-${completedColor}-180">${appointment.appointment_status}</span></td>
              </tr>
          `;
      });
  }

  document.getElementById("pastappointmentList").innerHTML = content;
}


// Clear Filters and Show All Records
function clearFilters() {
  document.getElementById("searchEmail").value = "";
  document.getElementById("searchDate").value = "";
  displayAppointments(window.filteredAppointments); // Show all records again
}





/* view past Appointments
document.getElementById("pastAppointments").addEventListener("click", function() {
  fetch('/api/get-doctor-appointments/')
      .then(response => response.json())
      .then(data => {
        const filteredAppointments = data.appointments.filter(
          (appointments) => appointments.appointment_status === "Completed" || appointments.appointment_status === "Cancelled"
        );

        document.getElementById("pastappointmentDialogue").classList.remove("hidden")

        console.log(filteredAppointments);
        if (filteredAppointments.length === 0) {
          pastappointmentList.innerHTML = "<p class='text-gray-500 text-center'>No past appointments Exist.</p>";
          return;
      }
          let content = "";
          filteredAppointments.forEach(appointment => {
            let text_color = (appointment.appointment_status === "Completed") ? "Cancelled" : "";
                let completedColor = (text_color) ? "green" : "red";
              content += `
                    <tr class="border-b">
                    <td class="px-4 py-2">${appointment.patient_email}</td>
                    <td class="px-4 py-2">${appointment.appointment_date}</td>
                    <td class="px-4 py-2">${appointment.appointment_time}</td>
                    <td class="px-4 py-2">
                      <button onclick="openPrescription('${appointment.id}', '${appointment.appointment_date}')" 
                        style="background: none; border: none;">
                        üìÑüìÑüìÑüìÑ
                      </button>
                    </td>
                    <td class="px-4 py-2"><span class="bg-white text-${completedColor}-180">${appointment.appointment_status}</span></td>
                </tr>
              `;
          });
          document.getElementById("pastappointmentList").innerHTML = content;
      });
});






/*
function openPrescription(patient_email, date) {
    fetch('/manage-prescription/', { 
        method: "POST", 
        body: JSON.stringify({ patient_email, date }),
        headers: { "Content-Type": "application/json" }
    })
    .then(() => alert("Prescription opened"));
}
*/

function openPrescription(appointmentId) {
  document.getElementById('appointmentId').value = appointmentId;
  
  // Fetch prescription details if exists
  fetch(`/get_prescription/${appointmentId}/`)
      .then(response => response.json())
      .then(data => {
        console.log(data);
          if (data.prescription) {
              document.getElementById('prescriptionId').value = data.prescription.id;
              document.getElementById('bloodPressure-sys').value = data.prescription.blood_pressure_sys || "";
              document.getElementById('bloodPressure-dias').value = data.prescription.blood_pressure_dias || "";
              document.getElementById('diabetes').value = data.prescription.diabetes || "";
              document.getElementById('medication').value = data.prescription.medication || "";
              document.getElementById('notes').value = data.prescription.notes || "";
          }
          document.getElementById('prescription-info').innerHTML = `

          <span>Patients detail</span>
          <h4>${data.prescription.patient_name}</h4>
          ${data.prescription.date} | ${data.prescription.time}

          `;
      });

  document.getElementById('prescriptionModal').classList.remove('hidden');
  
}

document.getElementById('closeModal').addEventListener('click', () => {
  document.getElementById('prescriptionModal').classList.add('hidden');
  document.getElementById('prescriptionId').value = "";
  document.getElementById('bloodPressure-sys').value ="";
  document.getElementById('bloodPressure-dias').value ="";
  document.getElementById('diabetes').value ="";
  document.getElementById('medication').value ="";
  document.getElementById('notes').value ="";
  document.getElementById('prescription-info').value = ``;
});

document.getElementById('prescriptionForm').addEventListener('submit', function (event) {
  event.preventDefault();
  
  const prescriptionData = {
      id: document.getElementById('prescriptionId').value,
      appointment_id: document.getElementById('appointmentId').value,
      blood_pressure_systolic: document.getElementById('bloodPressure-sys').value,
      blood_pressure_diastolic: document.getElementById('bloodPressure-dias').value,
      diabetes: document.getElementById('diabetes').value,
      medication: document.getElementById('medication').value,
      notes: document.getElementById('notes').value
  };
  console.log(prescriptionData);

  fetch('/save_prescription/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') },
      body: JSON.stringify(prescriptionData)
  })
  .then(response => response.json())
  .then(data => {
      alert(data.message);
      document.getElementById('prescriptionModal').classList.add('hidden');
  })
  .catch(error => console.error('Error:', error));
});


function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.startsWith(name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}


function searchPatient() {
    let email = document.getElementById("searchEmail").value;
    fetch('/search-patient/', { 
        method: "POST", 
        body: JSON.stringify({ patient_email: email }),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => alert("Past records fetched!"));
}



      // Confirm Logout
  function confirmLogout() {
    if (confirm("Are you sure you want to logout?")) {
        window.location.href = "/logout/";
    }
}



  </script>
</body>
</html>
